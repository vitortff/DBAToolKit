--BEGIN PART 1

IF (SELECT  OBJECT_ID('t1')
   ) IS NOT NULL 
    DROP TABLE dbo.t1 ;
GO
CREATE TABLE dbo.t1 (c1 INT, c2 INT, c3 CHAR(50)) ;
SELECT TOP 10000
        IDENTITY( INT,1,1 ) AS n
INTO    #Nums
FROM    Master.dbo.SysColumns sc1
       ,Master.dbo.SysColumns sc2 ;

INSERT  INTO dbo.t1 (c1, c2, c3)
        SELECT  n
               ,n
               ,'C3'
        FROM    #Nums ;

DROP TABLE #Nums ;

--END PART 1  

--BEGIN PART 2

SET STATISTICS IO ON;
GO
UPDATE t1 SET  c1=1,c2=1
WHERE c2=1

GO
SET STATISTICS IO OFF;
GO

/*
HAVE A LOOK ABOUT THE STATISTICS

--Logical reads 84

*/

SET STATISTICS IO ON;
GO
UPDATE t1 SET  c1=1,c2=1
WHERE c2=1

GO
SET STATISTICS IO OFF;
GO

/*

NOW HAVE A LOOK ABOUT THE STATISTICS GENERATED BY THE OPTIMIZER

--logical reads 95

*/

CREATE INDEX teste2 ON t1 (c2)
--


SET STATISTICS IO ON;
GO
update t1 set c1=1,c2=1
where c2=1

GO
SET STATISTICS IO OFF;
GO
/*
HAVE A LOOK ABOUT THE STATISTICS
OBSERVE QUE APÓS O INDICES, AS ESTATISCA DE LEITURA DIMINUIRAM POR CONTA DO INDICE CRIADO

*/

DROP TABLE T1








select i.name "Index_Name",
i.type_desc "Type",
s.page_count,
s.record_count,
s.index_level
from sys.indexes i
join sys.dm_db_index_physical_stats(DB_ID(N'Desenvolvimento'),
		OBJECT_ID(N'dbo.t1'), NULL,NULL,'DETAILED') AS s
		on i.index_id=s.index_id
		where i.object_id=object_id(N'dbo.t1')
		
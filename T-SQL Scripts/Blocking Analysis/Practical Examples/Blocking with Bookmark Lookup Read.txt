--SPID1 (DISTINCT SESSION)

IF (SELECT  OBJECT_ID('dbo.t1')
   ) IS NOT NULL 
    DROP TABLE dbo.t1 ;
    
CREATE TABLE T1 (C1 INT, C2 INT);
CREATE NONCLUSTERED INDEX IDX_T1 ON T1(C1);

DECLARE
@CONTADOR INT,
@VALUE1 INT,
@VALUE2 INT

SET @CONTADOR=1
SET @VALUE1=1
SET @VALUE2=100

WHILE @CONTADOR <=100
BEGIN
INSERT INTO T1 VALUES (@VALUE1,@VALUE2);
SET @VALUE1=@VALUE1+1
SET @VALUE2=@VALUE2-1
SET @CONTADOR=@CONTADOR+1
END


BEGIN TRANSACTION
SELECT C2 FROM T1 
WITH(FORCESEEK,REPEATABLEREAD) --REAPEATABLE HINT HOLDS A SHARED LOCK "S" UNTIL THE END OF THE TRANSACTION
WHERE C1=1; 


--SPID2 (DISTINCT SESSION)

  SELECT tl.request_session_id
	,tl.resource_database_id
	,tl.resource_associated_entity_id
	,tl.resource_type
	,tl.resource_description
	,tl.request_mode
	,tl.request_status
  FROM sys.dm_tran_locks tl
  WHERE resource_type <> 'DATABASE'
  ORDER BY 3,1,4 desc;
  
--SPID3 (DISTINCT SESSION)

  DELETE FROM T1 WHERE C1 >1;

  DELETE FROM T1 WHERE C1=1; --THERE'LL BE A BLOCKING
  
  
  
  